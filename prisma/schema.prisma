// =====================
// Prisma Configuration
// =====================

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// =====================
// USERS
// =====================

model users {
  idusuario       Int               @id @default(autoincrement())
  name            String?
  lastname        String?
  email           String            @unique
  password_hash   String
  role            String            @default("user")
  created_at      DateTime          @default(now())

  // relations
  animales        animal[]          @relation("UserAnimales")
  password_resets password_resets[]

  @@map("users")
}

// =====================
// PASSWORD RESETS
// =====================

model password_resets {
  id              Int       @id @default(autoincrement())
  user_id         Int
  reset_token     String?
  expiration_date DateTime?

  // relations
  user users @relation(fields: [user_id], references: [idusuario])

  @@map("password_resets")
}

// =====================
// FORMULARIOS
// =====================

model formulario {
  idformulario                 Int    @id @default(autoincrement())
  nombre                       String?
  apellido                     String?
  telefono                     Int?
  mail                         String?
  fecha_nacimiento             String?
  direccion                    String?
  ciudad                       String?
  provincia                    String?
  codigo_postal                Int?
  pais                         String?
  tipo_documento               String?
  numero_documento             Int?
  tipo_vivienda                String
  espacio_seguro               String
  tiempo_solo                  Int
  personas_encasa              Int
  familia_deacuerdo            String
  otras_mascotas_anteriormente String
  tipo                         String
  eventos                      String
  otras_mascotas_actualmente   Int
  tipo_mascotas_actual         String
  recursos                     String
  vacunar_y_esterilizar        String
  encargado_cuidado            String
  sitio_animal_solo            String
  rol_del_animal               String
  estado                       String

  @@map("formulario")
}

// =====================
// PRODUCTS
// =====================

model productos {
  idproducto Int       @id @default(autoincrement())
  nombre     String?
  url_imagen String?
  stock      Int

  // relations
  compras    compra[]

  @@map("productos")
}

// =====================
// PURCHASES
// =====================

model compra {
  idcompra Int @id @default(autoincrement())
  producto Int?
  unidades Int?
  precio   Int?

  // relations
  productoRef productos? @relation(fields: [producto], references: [idproducto], onDelete: SetNull)

  @@map("compra")
}

// =====================
// ANIMALS
// =====================

model animal {
  idanimal    Int      @id @default(autoincrement())
  nombre      String?
  edad        Int?
  descripcion String?
  imagen_m    String?
  dueno       Int?      @map("due√±o")
  perfilId    Int?

  // relations
  duenoRef    users?             @relation("UserAnimales", fields: [dueno], references: [idusuario], onDelete: SetNull)
  perfil      perfil?            @relation(fields: [perfilId], references: [idperfil], onDelete: SetNull)
  turnos      turno[]
  historiales historial_medico[] @relation("AnimalHistorial")

  @@map("animal")
}

// =====================
// APPOINTMENTS (TURNOS)
// =====================

model turno {
  idturno Int    @id @default(autoincrement())
  mascota Int?
  motivo  String?
  fecha   String?
  estado  String

  mascotaRef animal? @relation(fields: [mascota], references: [idanimal], onDelete: SetNull)

  @@map("turno")
}

// =====================
// PROFILES
// =====================

model perfil {
  idperfil  Int         @id @default(autoincrement())
  nombre    String?
  apellido  String?
  telefono  Int?
  mail      String?

  // relations
  mascotas  animal[]
  consultas consultas[]

  @@map("perfil")
}

// =====================
// CONSULTATIONS
// =====================

model consultas {
  idconsulta  Int     @id @default(autoincrement())
  nombre      Int?
  descripcion String?

  perfilRef perfil? @relation(fields: [nombre], references: [idperfil], onDelete: SetNull)

  @@map("consultas")
}

// =====================
// MEDICAL HISTORY
// =====================

model historial_medico {
  idhistorial    Int     @id @default(autoincrement())
  mascota        Int?
  turnos_pasados String?
  vacunas        String?

  mascotaRef animal? @relation("AnimalHistorial", fields: [mascota], references: [idanimal], onDelete: SetNull)

  @@map("historial_medico")
}

// =====================
// BACKEND EXTRA MODELS
// =====================

model pet {
  id        String   @id
  nombre    String
  especie   String
  foto      String?
  adoptable Boolean  @default(true)
  createdAt DateTime @default(now())

  @@map("pets")
}

model appointment {
  id      String   @id
  userId  Int?
  petId   String?
  motivo  String
  fecha   DateTime @default(now())

  @@map("appointments")
}

model coupon {
  id     Int    @id @default(autoincrement())
  code   String @unique
  active Boolean @default(true)

  @@map("coupons")
}
