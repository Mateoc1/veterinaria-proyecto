// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ============ USERS / AUTHENTICATION ============
model users {
  idusuario   Int      @id @default(autoincrement())
  name        String?
  lastname    String?
  email       String   @unique
  password_hash String
  role        String   @default("user")
  created_at  DateTime @default(now())

  // relations
  animales    animal[] @relation("UserAnimales")
  password_resets password_resets[]

  @@map("users")
}

model password_resets {
  id                Int      @id @default(autoincrement())
  user_id           Int
  reset_token       String?
  expiration_date   DateTime?

  // relations
  user              users    @relation(fields: [user_id], references: [idusuario], onDelete: Cascade)

  @@map("password_resets")
// (Fin del schema)
  sitio_animal_solo               String
  rol_del_animal                  String
  estado                          String

  @@map("formulario")
}

// ============ PRODUCTS ============
model productos {
  idproducto Int     @id @default(autoincrement())
  nombre     String?
  url_imagen String?
  stock      Int

  // relations
  compras    compra[]

  @@map("productos")
}

// ============ PURCHASES ============
model compra {
  idcompra Int  @id @default(autoincrement())
  producto Int?
  unidades Int?
  precio   Int?

  // relations
  productoRef productos? @relation(fields: [producto], references: [idproducto], onDelete: SetNull)

  @@map("compra")
}

// ============ ANIMALS ============
model animal {
  idanimal    Int      @id @default(autoincrement())
  nombre      String?
  edad        Int?
  descripcion String?
  imagen_m    String?
  dueno       Int?     @map("due√±o")
  perfilId    Int?     // <-- FK al perfil

  // relations
  duenoRef    users?    @relation("UserAnimales", fields: [dueno], references: [idusuario], onDelete: SetNull)
  perfil      perfil?   @relation(fields: [perfilId], references: [idperfil], onDelete: SetNull)
  turnos      turno[]
  historiales historial_medico[]

  @@map("animal")
}


// ============ APPOINTMENTS ============
model turno {
  idturno Int    @id @default(autoincrement())
  mascota Int?
  motivo  String?
  fecha   String?
  estado  String

  // relations
  mascotaRef animal? @relation(fields: [mascota], references: [idanimal], onDelete: SetNull)

  @@map("turno")
}

// ============ PROFILES ============
model perfil {
  idperfil   Int       @id @default(autoincrement())
  nombre     String?
  apellido   String?
  telefono   Int?
  mail       String?

  // relations
  mascotas   animal[]      // un perfil tiene varias mascotas
  consultas  consultas[]

  @@map("perfil")
}


// ============ CONSULTATIONS ============
model consultas {
  idconsulta  Int     @id @default(autoincrement())
  nombre      Int?
  descripcion String?

  // relations
  perfilRef perfil? @relation(fields: [nombre], references: [idperfil], onDelete: SetNull)

  @@map("consultas")
}

// ============ MEDICAL HISTORY ============
model historial_medico {
  idhistorial    Int     @id @default(autoincrement())
  mascota        Int?
  turnos_pasados String?
  vacunas        String?

  // relations
  mascotaRef animal? @relation(fields: [mascota], references: [idanimal], onDelete: SetNull)

  @@map("historial_medico")
}
<<<<<<< HEAD

/*model User {
  id           Int             @id @default(autoincrement())
  name         String?
  lastname     String?
  email        String          @unique
  passwordHash String          @map("password_hash")
  role         String          @default("user")
  createdAt    DateTime        @default(now()) @map("created_at")
  resets       PasswordReset[]

  @@map("users")
}

model PasswordReset {
  id        Int      @id @default(autoincrement())
  userId    Int      @map("user_id")
  token     String   @unique
  expiresAt DateTime @map("expires_at")
  used      Boolean  @default(false)

  user      User     @relation(fields: [userId], references: [id])

  @@map("password_resets")
}
*/
=======
>>>>>>> 6203609390c3c685550f841f6c7632b2926d5910
